# Replace with your real URL
$imgUrl = "https://raw.githubusercontent.com/LifeTimeScriptKiddie/blob/main/bigbrother.png"

$tmpPng = Join-Path $env:TEMP 'newwall.png'
$tmpJpg = Join-Path $env:TEMP 'newwall.jpg'
$dest   = 'C:\Temp\0.jpg'
$transcoded = Join-Path $env:APPDATA 'Microsoft\Windows\Themes\TranscodedWallpaper'

try {
    Invoke-WebRequest -Uri $imgUrl -OutFile $tmpPng -UseDefaultCredentials -ErrorAction Stop
} catch {

    Write-Error "Download failed: $($_.Exception.Message)"
    break
}

# Convert to JPEG
Add-Type -AssemblyName System.Drawing
$img = [System.Drawing.Image]::FromFile($tmpPng)
$img.Save($tmpJpg, [System.Drawing.Imaging.ImageFormat]::Jpeg)
$img.Dispose()

# Overwrite the discovered wallpaper file
Copy-Item -Path $tmpJpg -Destination $dest -Force

# Optional: update TranscodedWallpaper too (helps Themes UI)
Copy-Item -Path $tmpJpg -Destination $transcoded -Force

# Call Win32 API to set wallpaper and notify system
$code = @"
using System;
using System.Runtime.InteropServices;
public static class WinAPI {
    [DllImport("user32.dll", SetLastError=true)]
    public static extern bool SystemParametersInfo(int uAction, int uParam, string lpvParam, int fuWinIni);
}
"@
Add-Type $code
# 20 = SPI_SETDESKWALLPAPER, 3 = SPIF_UPDATEINIFILE | SPIF_SENDCHANGE
[void][WinAPI]::SystemParametersInfo(20, 0, $dest, 3)

Write-Host "Done. If the wallpaper didn't update, open ms-settings:personalization-background to force-refresh."
